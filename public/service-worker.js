/* eslint-disable no-restricted-globals */
import { registerRoute } from 'workbox-routing';
import { StaleWhileRevalidate, CacheFirst } from 'workbox-strategies';
import { precacheAndRoute } from 'workbox-precaching';

// Precache all the assets generated by the build process.
precacheAndRoute(self.__WB_MANIFEST || [], {
  maximumFileSizeToCacheInBytes: 50 * 1024 * 1024, // 50 MB
});

// Immediately take control of the page
self.skipWaiting();
self.clients.claim();

// Listen for messages from the client to skip waiting
self.addEventListener('message', (event) => {
  if (event.data && event.data.type === 'SKIP_WAITING') {
    self.skipWaiting();
  }
});

// Cache exchange rate API requests
registerRoute(
  ({ url }) => url.origin === 'https://open.er-api.com',
  new StaleWhileRevalidate({
    cacheName: 'exchange-rates-cache',
  })
);

// Cache other API requests as needed
registerRoute(
  ({ url }) => url.origin === 'https://cedio.github.io', // Update with your API domain if different
  new StaleWhileRevalidate({
    cacheName: 'api-cache',
  })
);

// Cache images
registerRoute(
  ({ request }) => request.destination === 'image',
  new CacheFirst({
    cacheName: 'image-cache',
  })
);

// Fallback to index.html for navigation requests (for React Router)
registerRoute(
  ({ request }) => request.mode === 'navigate',
  async () => {
    return caches.match('/pay-as-we-go/index.html', { ignoreSearch: true });
  }
);
